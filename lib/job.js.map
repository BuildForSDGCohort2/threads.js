{"version":3,"sources":["job.js"],"names":[],"mappings":";;;;;;;;;;6BACyB,eAAe;;;;IAEnB,GAAG;YAAH,GAAG;;AACX,WADQ,GAAG,CACV,IAAI,EAAE;;;0BADC,GAAG;;AAEpB,4BAAO,CAAC;AACR,QAAI,CAAC,IAAI,GAAK,IAAI,CAAC;AACnB,QAAI,CAAC,MAAM,GAAG,IAAI,CAAC;;AAEnB,QAAI,CAAC,oBAAoB,GAAG,KAAK,CAAC;AAClC,QAAI,CAAC,qBAAqB,GAAG,EAAE,CAAC;AAChC,QAAI,CAAC,UAAU,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACjD,YAAK,qBAAqB,CAAC,OAAO,GAAG,OAAO,CAAC;AAC7C,YAAK,qBAAqB,CAAC,MAAM,GAAG,MAAM,CAAC;KAC5C,CAAC,CAAC;;AAEH,QAAI,CAAC,OAAO,GAAG,EAAE,CAAC;AAClB,QAAI,CAAC,kBAAkB,EAAE,CAAC;;AAE1B,QAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;GAC3B;;AAjBkB,KAAG,WAmBtB,GAAG,GAAA,eAAU;sCAAN,IAAI;AAAJ,UAAI;;;AACT,QAAI,IAAI,CAAC,MAAM,KAAK,CAAC,EAAE;AACrB,YAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;KAC1D;;AAED,QAAI,CAAC,OAAO,GAAG,IAAI,CAAC;AACpB,WAAO,IAAI,CAAC;GACb;;AA1BkB,KAAG,WA4BtB,IAAI,GAAA,gBAAU;AACZ,QAAI,IAAI,CAAC,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;AAC7B,YAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;KAClD;;uCAHK,IAAI;AAAJ,UAAI;;;AAKV,QAAI,IAAI,CAAC,gBAAgB,EAAE,EAAE;;;;AAE3B,aAAO,6BAAA,IAAI,CAAC,KAAK,EAAE,CAAC,kBAAkB,EAAE,EAAC,IAAI,MAAA,4BAAI,IAAI,CAAC,CAAC;KACxD;;AAED,QAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;AACrB,QAAI,CAAC,YAAY,GAAG,IAAI,CAAC;;AAEzB,QAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;AACxB,WAAO,IAAI,CAAC;GACb;;AA3CkB,KAAG,WA6CtB,SAAS,GAAA,mBAAC,MAAM,EAAE;;;AAChB,6BAAA,qBAAA,MAAM,CACH,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,CAC7C,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,EAC5C,GAAG,MAAA,oBAAI,IAAI,CAAC,OAAO,CAAC,EACpB,IAAI,MAAA,wBAAI,IAAI,CAAC,QAAQ,CAAC,CAAC;;AAE1B,QAAI,CAAC,IAAI,CAAC,oBAAoB,EAAE;AAC9B,UAAI,CAAC,aAAa,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,CAAC;KACtC;;AAED,QAAI,CAAC,MAAM,GAAG,MAAM,CAAC;AACrB,WAAO,IAAI,CAAC;GACb;;AA1DkB,KAAG,WA4DtB,aAAa,GAAA,uBAAC,cAAc,EAAE;;;AAC5B,kBAAc,CACX,IAAI,CAAC,UAAA,MAAM,EAAI;AACd,aAAK,qBAAqB,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AAC3C,aAAO,MAAM,CAAC;KACf,CAAC,SACI,CAAC,YAAe;;;AACpB,gCAAA,OAAK,qBAAqB,EAAC,MAAM,MAAA,mCAAW,CAAC;KAC9C,CAAC,CAAC;;AAEL,QAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;GAClC;;AAvEkB,KAAG,WAyEtB,OAAO,GAAA,mBAAG;AACR,WAAO,IAAI,CAAC,UAAU,CAAC;GACxB;;AA3EkB,KAAG,WA6EtB,KAAK,GAAA,iBAAG;AACN,QAAM,KAAK,GAAG,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;;AAEjC,QAAI,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;AAC3B,WAAK,CAAC,GAAG,MAAA,CAAT,KAAK,EAAQ,IAAI,CAAC,OAAO,CAAC,CAAC;KAC5B;AACD,QAAI,IAAI,CAAC,YAAY,EAAE;AACrB,WAAK,CAAC,IAAI,MAAA,CAAV,KAAK,EAAS,IAAI,CAAC,QAAQ,CAAC,CAAC;KAC9B;;AAED,WAAO,KAAK,CAAC;GACd;;AAxFkB,KAAG,WA0FtB,gBAAgB,GAAA,4BAAG;AACjB,WAAO,IAAI,CAAC,YAAY,CAAC;GAC1B;;AA5FkB,KAAG,WA8FtB,kBAAkB,GAAA,8BAAG;AACnB,QAAI,CAAC,YAAY,GAAI,KAAK,CAAC;AAC3B,QAAI,CAAC,QAAQ,GAAG,EAAE,CAAC;AACnB,WAAO,IAAI,CAAC;GACb;;SAlGkB,GAAG;;;qBAAH,GAAG","file":"job.js","sourcesContent":["\nimport EventEmitter from 'eventemitter3';\n\nexport default class Job extends EventEmitter {\n  constructor(pool) {\n    super();\n    this.pool   = pool;\n    this.thread = null;\n\n    this.promiseBoundToThread = false;\n    this.promiseControlMethods = {};\n    this.jobPromise = new Promise((resolve, reject) => {\n      this.promiseControlMethods.resolve = resolve;\n      this.promiseControlMethods.reject = reject;\n    });\n\n    this.runArgs = [];\n    this.clearSendParameter();\n\n    pool.emit('newJob', this);\n  }\n\n  run(...args) {\n    if (args.length === 0) {\n      throw new Error('Cannot call .run() without arguments.');\n    }\n\n    this.runArgs = args;\n    return this;\n  }\n\n  send(...args) {\n    if (this.runArgs.length === 0) {\n      throw new Error('Cannot .send() before .run().');\n    }\n\n    if (this.hasSendParameter()) {\n      // do not alter this job, clone it and set send param instead\n      return this.clone().clearSendParameter().send(...args);\n    }\n\n    this.sendArgs = args;\n    this.parameterSet = true;\n\n    this.emit('readyToRun');\n    return this;\n  }\n\n  executeOn(thread) {\n    thread\n      .once('message', this.emit.bind(this, 'done'))\n      .once('error', this.emit.bind(this, 'error'))\n      .run(...this.runArgs)\n      .send(...this.sendArgs);\n\n    if (!this.promiseBoundToThread) {\n      this.bindPromiseTo(thread.promise());\n    }\n\n    this.thread = thread;\n    return this;\n  }\n\n  bindPromiseTo(anotherPromise) {\n    anotherPromise\n      .then(result => {\n        this.promiseControlMethods.resolve(result);\n        return result;\n      })\n      .catch((...errors) => {\n        this.promiseControlMethods.reject(...errors);\n      });\n\n    this.promiseBoundToThread = true;\n  }\n\n  promise() {\n    return this.jobPromise;\n  }\n\n  clone() {\n    const clone = new Job(this.pool);\n\n    if (this.runArgs.length > 0) {\n      clone.run(...this.runArgs);\n    }\n    if (this.parameterSet) {\n      clone.send(...this.sendArgs);\n    }\n\n    return clone;\n  }\n\n  hasSendParameter() {\n    return this.parameterSet;\n  }\n\n  clearSendParameter() {\n    this.parameterSet  = false;\n    this.sendArgs = [];\n    return this;\n  }\n}\n"],"sourceRoot":"/source/"}