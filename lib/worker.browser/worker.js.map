{"version":3,"sources":["worker.browser/worker.js"],"names":[],"mappings":"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","file":"worker.browser/worker.js","sourcesContent":["import EventEmitter from 'eventemitter3';\nimport slaveCode from './slave-code';\n\nimport { getConfig } from '../config';\n\n\nif (typeof window.Worker !== 'object' && typeof window.Worker !== 'function') {\n  throw new Error('Browser does not support web workers!');\n}\n\nconst slaveCodeDataUri = 'data:text/javascript;charset=utf-8,' + encodeURI(slaveCode);\n\n\nfunction prependScriptUrl(scriptUrl) {\n  const prefix = getConfig().basepath.web;\n  return prefix ? prefix + '/' + scriptUrl : scriptUrl;\n}\n\nfunction convertToArray(input) {\n  let outputArray = [];\n  let index = 0;\n\n  while (typeof input[index] !== 'undefined') {\n    outputArray.push(input[index]);\n    index++;\n  }\n\n  return outputArray;\n}\n\n\nexport default class Worker extends EventEmitter {\n  constructor(initialScript = null, importScripts = []) {\n    super();\n\n    this.worker = new window.Worker(slaveCodeDataUri);\n    this.worker.addEventListener('message', this.handleMessage.bind(this));\n    this.worker.addEventListener('error', this.handleError.bind(this));\n\n    if (initialScript) {\n      this.run(initialScript, importScripts);\n    }\n  }\n\n  run(toRun, importScripts = []) {\n    if (typeof toRun === 'function') {\n      this.runMethod(toRun, importScripts);\n    } else {\n      this.runScripts(toRun, importScripts);\n    }\n    return this;\n  }\n\n  runMethod(method, importScripts) {\n    const methodStr = method.toString();\n    const args = methodStr.substring(methodStr.indexOf('(') + 1, methodStr.indexOf(')')).split(',');\n    const body = methodStr.substring(methodStr.indexOf('{') + 1, methodStr.lastIndexOf('}'));\n\n    this.worker.postMessage({\n      initByMethod : true,\n      method       : { args, body },\n      scripts      : importScripts.map(prependScriptUrl)\n    });\n  }\n\n  runScripts(script, importScripts) {\n    if (!script) { throw new Error('Must pass a function or a script URL to run().'); }\n\n    // attention: array for browser, single script for node\n    this.worker.postMessage({\n      initByScripts : true,\n      scripts       : importScripts.concat([ script ]).map(prependScriptUrl)\n    });\n  }\n\n  send(param, transferables = []) {\n    this.worker.postMessage({\n      doRun : true,\n      param\n    }, transferables);\n    return this;\n  }\n\n  kill() {\n    this.worker.terminate();\n    this.emit('exit');\n    return this;\n  }\n\n  promise() {\n    return new Promise((resolve, reject) => {\n      this\n        .once('message', resolve)\n        .once('error', reject);\n    });\n  }\n\n  handleMessage(event) {\n    if (event.data.error) {\n      this.handleError(event.data.error);\n    } else {\n      const responseArgs = convertToArray(event.data.response);\n      this.emit('message', ...responseArgs);\n    }\n  }\n\n  handleError(error) {\n    if (!this.listeners('error', true)) {\n      if (error.stack) {\n        console.error(error.stack);                                             // eslint-disable-line no-console\n      } else if (error.message && error.filename && error.lineno) {\n        const fileName = error.filename.match(/^data:text\\/javascript/) && error.filename.length > 50\n                       ? error.filename.substr(0, 50) + '...'\n                       : error.filename;\n        console.error(`${error.message} @${fileName}:${error.lineno}`);   // eslint-disable-line no-console\n      } else {\n        console.error(error);                                                   // eslint-disable-line no-console\n      }\n    }\n    this.emit('error', error);\n  }\n}\n"],"sourceRoot":"/source/"}